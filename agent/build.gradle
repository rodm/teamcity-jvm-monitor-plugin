
apply plugin: 'java'

repositories {
    mavenCentral()
    maven {
        url "http://repository.jetbrains.com/all"
    }
}

def javaHome = System.properties['java.home']

sourceCompatibility = 1.7
targetCompatibility = 1.7

archivesBaseName = 'agent-jvm-monitor-plugin'

dependencies {
    compile files("${javaHome}/../lib/tools.jar")
    compile "org.jetbrains.teamcity:agent-api:${teamCityVersion}"

    testCompile group: 'junit', name: 'junit', version: "${junitVersion}"
}

jar {
    exclude "**/teamcity-plugin.xml"
}

task packageAgentPlugin(type: Zip, dependsOn: jar) {
    from(libsDir) {
        into "lib"
    }
    from(sourceSets.main.resources) {
        include "teamcity-plugin.xml"
    }
}

assemble.dependsOn packageAgentPlugin
